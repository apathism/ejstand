# Maintainer: Ivan Koryabkin <apathism@apathism.net>

# This is not recommended way for installing ejStand.
# You should use archlinux-static version of this package, if executable size
# is not important for you.

_pkgname=ejstand
pkgname="${_pkgname}"
pkgver=0.2.0
pkgrel=1
pkgdesc='Ejudge Configurable Web Standings Daemon for Multiple Contests'
url="https://apathism.net/git/apathism/${_pkgname}"
arch=('x86_64')
license=('AGPL3')
depends=('haskell-warp' 'haskell-xml-conduit' 'haskell-shakespeare')
makedepends=('ghc' 'haskell-clock' 'haskell-safe')
source=("${_pkgname}-${pkgver}.zip"::"https://apathism.net/git/apathism/${_pkgname}/archive/${pkgver}.zip")
sha256sums=('SKIP')
backup=('etc/ejstand.cfg')

build() {
    cd "${srcdir}/${_pkgname}"
    
    runhaskell Setup configure -O \
    	       --enable-shared \
	       --enable-executable-dynamic \
    	       --disable-library-vanilla \
               --prefix=/usr

    runhaskell Setup build
}

package() {
   cd "${srcdir}/${_pkgname}"

   runhaskell Setup copy --destdir="${pkgdir}"

   mkdir -p "${pkgdir}/etc/${_pkgname}"/{cfg,examples}
   
   install -Dm644 "conf/global.cfg.example" "${pkgdir}/etc/${_pkgname}.cfg"
   install -Dm644 "conf/local.cfg.example" "${pkgdir}/etc/${_pkgname}/examples/standing.cfg.example"
   install -Dm644 "dist/archlinux/${_pkgname}.service" "${pkgdir}/usr/lib/systemd/system/${_pkgname}.service"
}
